
\def\anon{1} %% set to 1 for anonymous submissions, hides acknowledgements and author names
\def\full{1} %% set to 0 for springer proceedings


\ifnum\full=1
\documentclass[11pt]{llncs}


\addtolength{\parskip}{1pt}
\else
\documentclass[10pt, runningheads]{llncs}
\usepackage{times}
\fi


\input{header.tex}

\begin{document}
	\title{Weightwise (almost) perfectly balanced functions based on total orders}

	
	\titlerunning{Weightwise (almost) perfectly balanced functions based on total orders}
	\author{
		\mbox{Pierrick M\'eaux}\inst{1}
	}
	
	\authorrunning{ P. M\'eaux}
	
	\institute{
	Luxembourg university, Luxembourg\\
		\email{pierrick.meaux@uni.lu}		
	}
	

	
	
	
	%----------------------------------------------------------------
	\maketitle


\institute{
%	University of Luxembourg, Luxembourg\\
%	\email{pierrick.meaux@uni.lu}		
}	
	
	\begin{abstract}
	
		
	\end{abstract}


\section{Introduction}



	
\subsection{Related works}
	

	
WPB constructions:
\cite{TOSC:CarMeaRot17}
\cite{DCC:LiuMes19,CC:TangLiu19,DAM:LiSu20,CC:MesSu21,AMC:ZhangSu21,BFA:MesSuLi21,DAM:GuoSu22,DAM:ZhuSu22,archiv:MPJDL22,DAM:GinMea22,INDO:GinMea22,ACI:ManKuLar22,CC:MSLZ22,eprint:GinMea22c}.


\section{Preliminaries}


For readability we use the notation $+$ instead of 
$\oplus$ to denote the addition in $\F_2$ and $\sum$ instead of $\bigoplus$. 
In addition to classic notations we denote $ [a,b] $ the subset of all integers between $a$ and $b$: $\{a, a+1, \ldots,b\}$. 
For a vector $v\in \F_2^n$ we use $\w(v)$ to denote its Hamming weight $\w(v)=|\{ i \in [1,n] \, | \, v_i=1 \}|$. For two vectors $v$ and $w$ of $\F_2^n$ we denote $\hd(v,w)$ the Hamming distance between $v$ and $w$, that is $\hd(v,w)=\w(v+w)$.

\subsection{Boolean functions and weightwise considerations}

In this part we recall general concepts on Boolean functions and their weightwise properties we use in this article. 
For a deeper introduction on Boolean functions and their cryptographic parameters we refer to the survey of \eg~\cite{Carlet20} and to~\cite{TOSC:CarMeaRot17} for the weightwise properties, also called properties on the slices.
For $k \in [0,n]$ we denote $\Ekn{k}{n}$ the set $\{x\in \F_2^n \, | \, \w(x)=k  \}$ and call it slice of the Boolean hypercube (of dimension $n$). 
Accordingly, the Boolean hypercube is partitioned into $n+1$ slices where the elements have the same Hamming weight.

\begin{definition}[Boolean Function]\label{def:bool_f}
	A Boolean function $f$ in $n$ variables is a function from $\F_2^n$ to $\F_2$. 
	The set of all Boolean functions in $n$ variables is denoted by $\BN$, and we denote $\BN^*$ the set without the null function.
\end{definition}


To denote when a property or a definition is restricted to a slice we use the subscript $k$. 
For example, for a $n$-variable Boolean function $f$ we denote its support $\supp(f)=\{x\in \F_2^n \, | \, f(x)=1  \}$ and we denote $\suppk{k}(f)$ its support restricted to a slice, that is $\supp(f)\cap \Ekn{k}{n}$.


\begin{definition}[Balancedness]\label{def:balancedness}
	A Boolean function $f\in \BN$ is called balanced if $|\supp(f)|=2^{n-1}=|\supp(f+1)|$. 
	
	For $k\in [0,n]$ the function is said balanced on the slice $k$ if $||\suppk{k}(f)|-|\suppk{k}(f+1)| |\le 1$. In particular when $|\Ekn{k}{n}|$ is even $|\suppk{k}(f)|=|\suppk{k}(f+1)|=|\Ekn{k}{n}|/2$.
\end{definition}

\begin{definition}[Weightwise Perfectly Balanced Function (WPB)]\label{def:WPB}
	Let $m\in \N^*$ and $f$ be a Boolean function in $n=2^m$ variables. 
	The function $f$ is called weightwise perfectly balanced (WPB) if, for every $k\in[n-1]$, $f$ is balanced on the slice $k$, that is $\forall k \in [1,n-1], |\suppk{k}(f)|=\binom{n}{k}/2$, and:
	\[f(0,\dots,0)=0,\quad \text{ and } \quad f(1,\dots,1)=1.\]
	
	The set of WPB functions in $2^m$ variables is denoted $\WPB{m}$.
	
	
\end{definition}


\begin{definition}[Weightwise (Almost) Perfectly Balanced Function (WPB and WAPB)]\label{def:WAPB}
	Let $m\in \N^*$ and $f$ be a Boolean function in $n=2^m$ variables. It will be called weightwise perfectly balanced (WPB) if, for every $k\in[1,n-1]$, $f$ is balanced on the slice $k$, that is $\forall k \in [1,n-1], |\suppk{k}(f)|=\binom{n}{k}/2$, and:
	\[f(0,\cdots,0)=0,\quad \text{ and } f(1,\cdots,1)=1.\]	
	The set of WPB functions in $2^m$ variables is denoted $\WPB{m}$.
	
	When $n$ is not a power of $2$, other weights than $k=0$ and $n$ give slices of odd cardinality, we call $f\in \Bn{n}$ weightwise almost perfectly balanced (WAPB) if: 
	\[|\suppk{k}(f)|= \left \{
	\begin{array}{l l}
	|\Ekn{k}{n}|/2  & \text{ if } |\Ekn{k}{n}| \text{ is even, } \\
	(|\Ekn{k}{n}|\pm 1)/2  & \text{ if }  |\Ekn{k}{n}| \text{ is odd.}
	\end{array}\right.\]
	The set of WAPB functions in $n$ variables is denoted $\WAPB{n}$.		
\end{definition}



\begin{definition}[Walsh transform and restricted Walsh transform]\label{def:walsh_transform}
	Let $f\in \Bn{n}$ be a Boolean function, its Walsh transform $\wt{f}$ at $a \in \F_2^n$ is defined as:
	\[  \wt{f} (a) := \sum_{x \in \F_2^n} (-1)^{f(x) +  a \cdot x }.\]
	%	The Walsh support is the set $\Wsupp{f}:=\{ a\in \F_2^n\, | \, \wt{f} (a) \neq 0 \}$.
	Let $f\in \Bn{n}$, $S \subset \F_2^n$, its Walsh transform restricted to $S$ at $a \in \F_2^n$ is defined as:
	\[  \wt{f,S} (a) := \sum_{x\in S} (-1)^{f(x)+ax}.\]
	For $S=\Ekn{k}{n}$ we denote $\wt{f,\Ekn{k}{n}} (a)$ by $\wtk{f}{k}(a)$, and for $a= 0_{n}$ we denote $\wtk{f}{k}(a)$ as $\wtk{f}{k}(0)$.
\end{definition}


\begin{definition}[Algebraic Normal Form (ANF) and degree]\label{def:anf}
We call Algebraic Normal Form of a Boolean function $f$ its $n$-variable polynomial representation over $\F_2$ (\textit{i.e.} belonging to $\F_2[x_1,\dots,x_n]/(x_1^2+x_1,\dots,x_n^2+x_n)$):
	\[f(x_1,\dots,x_n)= \sum_{I \subseteq [1,n]} a_I \left( \prod_{i \in I} x_i \right) \]%x_1,\dots,x_n=\sum_{I \subseteq [1,n]} a_I x^I,\]
	where $a_I\in \F_2$. 
%The (algebraic) degree of $f$, denoted $\degg(f)$ is: \[\degg(f):=\left\{\begin{array}{l}
%	\max_{I\subseteq [1,n]}\{ |I|\, | \, a_I=1\}  \text{ if $f$ is not null}\\
%	0  \text{ otherwise}.
%	\end{array}\right.\]	
The (algebraic) degree of $f$, denoted $\degg(f)$ is: \[\degg(f)=\
\max_{I\subseteq [1,n]}\{ |I|\, | \, a_I=1\}  \text{ if $f$ is not null},0  \text{ otherwise}.\]
\end{definition}	


\begin{definition}[Algebraic Immunity] \label{def:ai}
	The algebraic immunity of a Boolean function $f\in \Bfn{n}$, denoted as $\AI(f)$, is defined as:
	\[ \AI(f) = \min_{g \neq 0}\{ \degg(g) \; | \; fg = 0 \; \text{or} \; (f + 1)g = 0 \}{,} \]
	where $\degg(g)$ is the algebraic degree of $g$.
	The function $g$ is called an annihilator of $f$ (or $f + 1$). 
	Additionally we denote $\AN(f) = \min_{g \neq 0}\{ \degg(g) \; | \; fg = 0\}$.
\end{definition}

\begin{Prop}[Nonlinearity on the slice, adapted from~\cite{TOSC:CarMeaRot17}, Proposition 6]\label{prop:nlk}
	Let $n\in \N^*, k\in [0,n]$, for every $n$-variable Boolean function $f$ over $\Ekn{k}{n}$:
	\[ \NLk{k}(f)=\frac{|\Ekn{k}{n}|}{2} -\frac{\max_{a\in \F_2^n} |\wtk{f}{k}(a)|}{2}  .\]
\end{Prop}

\subsection{Families of WPB functions}







\begin{definition}[TL WPB construction (adapted from~\cite{CC:TangLiu19}, Construction $1$ )]\label{def:TL}
	Let $m \in \N^*$ and $n = 2^m \ge 4$ be an integer. A TL WPB Boolean function $f$ on $n$-variable is such that
	\begin{itemize}
	 \item $h(0_n)=0$ and $f(1_n)=1$ 
	 \item $h(x,y)=0$ if $\w(x)<\w(y)$.
	 \item $h(x,y)=1$ if $\w(x)>\w(y)$.
	 \item the cardinality of $U_i=\supp(f)\cap\set{(x,y)\in\F_2^{2^{m-1}}\times \F_2^{2^{m-1}}\colon \w(x)=\w(y)=j}$ is exactly $\binom{2^{m-1}}{j}^2/2$ for all $0<j<2^{m-1}$.
	\end{itemize}	
	% 	Let $(c_0,\dots,c_k)\in \set{0,1}^{k+1}$ such that $\sum c_j=0$
% 	\[
% 	 c_j=
% 	 \begin{cases}
% 	  0 & |\Ekn{j}{k}|\equiv 0 \pmod 2\\ 
% 	  \pm 1 & |\Ekn{j}{k}|\equiv 1 \pmod 2\\
% 	 \end{cases}
% 	\]
\end{definition}
\begin{remark}
 Despite Definition~\ref{def:TL} may appear quite different respect the original paper, it is equivalent when applying the constrains of our framework.
 Namely, here we consider only the case where $n$ is a power of two. Referring to Construction 1 of~\cite{CC:TangLiu19}, this implies that the coefficient $c_1,\dots,c_{k-1}$ must be zero. Moreover, in~\cite{CC:TangLiu19} $f(0_n)=0$ and $f(1_n)=1$ is not required for weightwise perfectly balancedness, differently from Definition~\ref{def:WPB}. This implies that in our context we can only instantiate their construction with $(-1,0,..,0,1)$ as input sequence, \ie as in Definition~\ref{def:TL}. 
\end{remark}

\begin{Prop}[TL WPB functions properties~\cite{CC:TangLiu19}]\label{Prop:TL}
	Let $m \in \N^*$ and $n=2^m$, a  $n$-variable TL function $h_n$ has optimal algebraic immunity $\AI(h_n)=\frac{n}{2}$.
\end{Prop}




\subsection{Symmetric Functions}


The $n$-variable \emph{Boolean symmetric functions} are those that are constant on each slice $\Ekn{k}{n}$ for $k\in [0,n]$. 
This class has been assiduously studied in the context of cryptography, see \eg \cite{IEEE:Carlet04,IEEE:CanVid05,INDO:BraPre05,DM:SarMai07,IEEE:QFLW09,CCDS:Meaux21,IEEE:CarMea21}.
%  The set of $n$-variable symmetric functions is denoted $\SYM{n}$.and $|\SYM{n}|=2^{n+1}$. 
In this paper we mainly consider two families of symmetric functions, which are both bases of the symmetric functions:

\begin{definition}[Elementary symmetric functions]
Let $i\in [0,n]$, the elementary symmetric function of degree $i$ in $n$ variables, denoted $\sigma_{i,n}$, is the function which ANF contains all monomials of degree $i$ and no monomials of other degrees. 
\end{definition}
\begin{definition}[Slice indicator functions]
 Let $k\in [0,n]$, the indicator function of the slice of weight $k$ is defined as:
 \[\forall  x\in \mathbb{F}_2^{n}, \quad \phikn{k}{n}(x) = 1 \text{ if and only if } \w(x) = k.\]
\end{definition}
%We recall that bent functions are those Boolean functions achieving maximal nonlinearity.

\begin{Prop}[Nonlinearity of $\sigma_{2,n}$]\label{prop:sigmaTwoBent}
	Let $n\in \N^*$ even, the elementary symmetric function $\sigma_{2,n}=\sum_{1\le i<j\le n}x_ix_j$ is bent, \ie 
	$\NL(\sigma_{2,n})=2^{n-1}-2^{n/2-1}$.
\end{Prop}


\begin{Prop}[Weightwise restricted Walsh transform and addition of symmetric function (~\cite{INDO:GinMea22}, Proposition $4$)]\label{prop:AddSym}
	Let $n\in \N^*$, $k\in [0,n]$ and $f \in \Bn{n}$, the following holds on $f+\phikn{k}{n}$
	\[\forall a\in \F_2^n, \forall i\in [0,n]\setminus \{k\}, \wtk{f+\phikn{k}{n}}{i}(a)=\wtk{f}{i}(a),\text{ and } \wtk{f+\phikn{k}{n}}{k}(a)=-\wtk{f}{i}(a).\]	
\end{Prop}

\subsection{Orders}


\begin{definition}[Order]
	
A binary relation $\preceq$	on a set $X$ is called partial order if $\preceq$ is reflexive, transitive and antisymmetric. Moreover, $\preceq$ is a total order if for all $a,b\in X$ it holds $a\preceq b$ or $b \preceq a$.
	
\end{definition}

We give two examples of orders on $n$-length binary string, more examples can be found in \eg ~\cite{FUN:SteWil12} that also considers order on sets of fixed Hamming weight:
\begin{itemize}
	\item Lexicographic, given $a,b \in \F_2^n$ as $a=a_1,\ldots, a_n$ and $b=b_1,\ldots,b_n$, $a\preceq b$ if and only if  $a_i<b_i$ on the first index $i\in [1,n]$ such that $a_i\ne b_i$, or $a=b$.
%\item Gray 
\item Cool~\cite{DM:RukWil09}, a first element of $\F_2^n$ is chosen and a successor rule is used to determine the following element, allowing to generate the $2^n$ elements with no repetition. The successor rule for $a_1,a_2,\ldots,a_n$ is: Let $i$ be the minimum value such that $(a_i,a_{i+1})=(1,0)$ and $i>1$. If $i$ exists, then rotate $i+1$ bits, otherwise flip $a_1$ and then rotate $n$ bits. 

\end{itemize}

\subsection{Krawtchouk polynomials}
For some proofs we will use Krawtchouk polynomials and some of their properties, we give the necessary preliminaries here and refer to \eg ~\cite{book:MacSlo78} for more details.

\begin{definition}[Krawtchouk Polynomials]\label{def:Kraw}
	The Krawtchouk polynomial of degree $k$, with $0\leq k\leq n$ is given by: $ \displaystyle \kraw{k}{\ell}{n}=\sum_{j=0}^{k} (-1)^j \binom{\ell}{j} \binom{n-\ell}{k-j}$. 
	%	Krawtchouk polynomials are characterized by the generating series: $ \displaystyle (1+z)^{n-x} (1-z)^x=\sum_{k=0}^\infty \kraw{k}{x}{n} z^k$.
\end{definition}


\begin{Prop}[Krawtchouk polynomials relations]\label{prop:Kr}
	Let $n\in \N^*$ and $k\in [0,n]$, the following hold:
	\begin{itemize}
		\item $\kraw{k}{\ell}{n}$ is the value of the restricted Walsh transform on $\Ekn{k}{n}$ of any $n$ variable linear function $a\cdot \ell$ such that $\w(a)=\ell$.
		%\item $\kraw{k}{n-x}{n}=(-1)^k \kraw{k}{x}{n}$,
		%\item $\kraw{n-k}{x}{n}=(-1)^x \kraw{k}{x}{n}$,
		%	\item if $n$ is even and $k$ is odd, $\kraw{k}{n/2}{n}=0$,
		%\item if $n$ is even, $\kraw{n/2}{1}{n}=0$.
		%	\item $\binom{n}{x}\kraw{k}{x}{n}=\binom{n}{k}\kraw{x}{k}{n}$.
	\end{itemize}	
\end{Prop}


\begin{Prop}[Vandermonde Convolution]\label{prop:Vandermonde}
	Let $a,b,c \in \N$. Then
	\begin{equation*}
	\binom{a+c}{b}=\sum_{j=0}^b\binom{c}{b-j}  \binom{a}{j}.
	\end{equation*}
\end{Prop}






















\section{Constructions based on total orders}

\subsection{Recursive construction}

We denote $\prec_m$ an order on $2^m$-length binary strings.

\begin{definition}\label{def:orderWPB}
	Let $m\in \N^*$, and for $i \in [0,m-1]$ $\preceq_i$ be a total order on the set of $2^i$-length binary string.
	
	Let $f_m$ be the $2^m$ function defined as:
	\begin{itemize}
		\item $f_m(0_{2^m})=0$, $f_m(1_{2^m})=1$,
		\item 	\[f_m(x,y)= \left \{
		\begin{array}{l l}
		f_{m-1}(x) & \text{ if }  x= y, \\
		0   & \text{ if }  x \prec_{m-1} y,\\
		1   & \text{ if }  y \prec_{m-1} x,
		\end{array}
		\right. \]
		where $x,y\in \F_2^{m-1}$.
	\end{itemize}
	
\end{definition}

\begin{theorem}\label{thm:orderWPB}
	
	Let $f_m$ defined as in Definition~\ref{def:orderWPB}, $f_m$ is weightwise perfectly balanced.
	
\end{theorem}
\begin{proof}

We prove it by recursion. 
First, $f_1(x,y)$ takes the value $0$ in $(0,0)$ and $1$ in $(1,1)$ since by definition $f_m(0_{2^m})=0$ and $f_m(1_{2^m})=1$. 
For the two elements $(x,y)\in \F_2^m$ such that $x\ne y$, that is $\Ekn{1}{n}$, it holds $0 \prec_0 1$ or $1 \prec_0 0$, hence $f_1$ takes the value $1$ on exactly one of them. 
Consequently $f_1$ is WPB, which proves the basis of the recursion.

Then, if for $j\in [1,m-1]$ $f_j$ is WPB we show that $f_{j+1}$ is also WPB. We denote $n=2^{j+1}$, $f_{j+1}(x,y)$ takes the value $0$ in $(0_n)$ and $1$ in $(1_n)$ by definition. Then, for any weight $k\in [1,n-1]$ the set $\Ekn{k}{n}$ can be split in the two sets $A=\{(x,y)\in \Ekn{k}{n} \,  | \, x=y\}$ and $B=\{(x,y)\in \Ekn{k}{n} \,  | \, x\ne y\}$. 
On the set $A$, $f_{j+1}(x,y)$ takes the value of $f_{j}(x)$, and since $\{x\in \F_2^{n/2} \, | \, (x,y) \in A\}=\Ekn{k/2}{n/2}$, the weightwise perfect balancedness of $f_{j}$ implies the balancedness of $f_{j+1}$ on $A$. 
Finally, the set $B$ can be split in pairs $(x,y)$ and $(y,x)$ (since all elements of $B$ are such that $x \ne y$). For each pair, either $x \prec_j y$ or $y \prec_j x$ hence $f_{j+1}(x,y)=1+f_{j+1}(y,x)$. Accordingly, $f_{j+1}$ is balanced on each of these pairs, hence on $B$, and therefore on the full slice $\Ekn{k}{n}$.
It allows to conclude the proof by recursion, $f_m$ is WPB.



	
\end{proof}

\begin{proposition}\label{propo:const1count}
	Let $m\in \N^*$ and, the number $\mathcal{C}_m$ of $2^m$-variable WPB functions from the family of Definition~\ref{def:orderWPB} is:
	\[\mathcal{C}_m=\prod_{i=0}^{m-1} 2^{2^{i}}!.\]

\end{proposition}
\begin{proof}
First, we note that if two functions $f$ and $g$ from the family are defined with a different order for $i$ in $[0,m-1]$ there exist two elements $x$ and $y$ in $\F_2^{2^i}$ such that $x\prec_{f,i} y$ and $y\prec_{g,i} x$ (where the subscript $f$ or $g$ indicate the order used in the definition of $f$ or $g$ respectively). 
Then, by Definition~\ref{def:orderWPB} $f(x,y)=0$ and $g(x,y)=1$, hence $f$ and $g$ are different functions. 
Therefore, the number of different WPB functions from this family if the product over $m$ of the number of total orders over binary strings of length $2^{i-1}$. Since there are $n!$ possible total orders on a set of size $n$, it gives the final result: $\prod_{i=0}^{m-1} 2^{2^{i}}!$.



\end{proof}




\subsection{Construction based on an unique order}

\begin{definition}\label{def:orderWPB2}
	Let $m\in \N^*$, and $\preceq$ be a total order on the set of $2^{m-1}$-length binary string. 
	%We denote $u$ and $v$ the $2^{m-1}$-th and $2^{m-1}+1$-th elements in this order.
	Let $\preceq'$ be a total order on the set of $2^{m-1}$-length binary string such that for all $k\in [1,2^{m-1}-1]$ exactly half of the elements of Hamming weight $k$ are in the smallest half. 
	We denote $u$ the $2^{m-2}$-th element in the order $\preceq'$.
	
	Let $g_m$ be the $2^m$ function defined as:
	\begin{itemize}
		\item $g_m(0_{2^m})=0$, $g_m(1_{2^m})=1$,
		\item 	\[g_m(x,y)= \left \{
		\begin{array}{l l}
		0   & \text{ if }  x \prec y,\\
		1   & \text{ if }  y \prec x,\\
		0 \text{ if } x\preceq' u, 1 \text{ otherwise } & \text{ if }  x= y, \\
		\end{array}
		\right. \]
		where $x,y\in \F_2^{m-1}$.
	\end{itemize}
	
\end{definition}





\begin{theorem}\label{thm:orderWPB2}
	
	Let $f_m$ as defined in Definition~\ref{def:orderWPB2}, $f_m$ is weightwise perfectly balanced.
	
\end{theorem}
\begin{proof}
We denote $n=2^m$. 
By definition $g_m(0_{2^m})=0$ and $g_m(1_{2^m})=1$, so we focus on the balancedness of $g_m$ on the slices $\Ekn{k}{n}$ for $k\in [1,n-1]$. Each slice $\Ekn{k}{n}$ can be written as $A \cup B$ where $A$ is the set of elements such that $x=y$, that is $A=\{(x,x) \, | \, x \in \F_2^{n/2} \} \cap \Ekn{k}{n}$, and $B$ is the set of elements such that $x\ne y$, that is $B=\{(x,y) \, | \, x,y \in \F_2^{n/2}, x \ne y \}\cap \Ekn{k}{n}$. 
By construction $A \cap B =\emptyset$. 

First, we show that $g_m$ is balanced over $A$. 
We remark that $|A|=|\Ekn{k/2}{n/2}|$ and more precisely $\{x\, | \, (x,x) \in A\}=\Ekn{k/2}{n/2}$. 
By definition of $\preceq'$ we have $|\{x \in \Ekn{k/2}{n/2}\, | \, x \preceq' u\}|= |\Ekn{k/2}{n/2}|/2$, hence $g_m$ is balanced on $A$.

Then, we prove the balancedness on $B$. $B$ can be partitioned into set of pairs $(x,y)$ and$ (y,x)$ and since $x \prec y$ or $y \prec x$ since $x\ne y$, $g_m$ is balanced on all the pairs and therefore on all $B$. 
Finally, $g_m$ is balanced on $A \cup B =\Ekn{k}{n}$ for all $k\in [1,n-1]$ which allows to conclude $g_m$ is WPB.
%\pmnote{It does not work without restriction on the "u order"

%if we use a second order where half of the elements of Hamming weight in $[1,n-1]$ are before the first half it is ok.
%}
		
\end{proof}

\begin{proposition}\label{const2count}
	Let $m\in \N^*$, the number $\mathcal{D}_m$ of $2^m$-variable WPB functions from the family of Definition~\ref{def:orderWPB2} is: \[\mathcal{D}_m=2^{2^{m-1}}!  \times \prod_{k=1}^{2^{m-1}-1} \binom{\binom{2^{m-1}}{k}}{\frac{ 1}{2} \binom{2^{m-1}}{k}}.\]
	
\end{proposition}
\begin{proof}
First, using the same argument as for Proposition~\ref{propo:const1count}, a different order for $\preceq$ gives a different function. 
Then, two functions $f$ and $g$ with only $\preceq'$ different can still be the same function if and only if for each $k\in [1,n/2-1]$ (where $n=2^m$) the same half of $\Ekn{k}{n/2}$ is in the smallest half. 
Indeed, if for all $k\in [1,n/2-1]$, the sets $\{x \in \Ekn{k}{n/2}\, | \, x\preceq_f' u_f\}$ and $\{x \in \Ekn{k}{n/2}\, | \, x\preceq_g' u_g\}$ are equal then $f(x,x)=g(x,x)$ for all $x\in \F_2^{n/2}$. 
And since we assumed $\preceq_f=\preceq_g$, for all $(x,y)\in \F_2^n \, | \, x\ne y$ we have $f(x,y)=g(x,y)$ therefore $f=g$. 
Conversely, if there exists $k\in [1,n/2-1]$ such that $x\in \Ekn{k}{n}$ satisfies $x\preceq'_f u_f$ and $x \not \preceq'_g u_g$ (without loss of generality) then $f(x,x)=0$ and $g(x,x)=1$, proving that $f \ne g$.

Finally, we derive the number of different functions, combining the number of different total order on binary strings of length $2^{m-1}$ and the number of partitions of $\Ekn{k}{2^{m-1}}$ in two parts of same size:
\[\mathcal{D}_m=2^{2^{m-1}}!  \times \prod_{k=1}^{2^{m-1}-1} \binom{\binom{2^{m-1}}{k}}{\frac{ 1}{2} \binom{2^{m-1}}{k}}.\]
	
	
\end{proof}



We study the nonlinearity and algebraic immunity of these families. First, we show a lower bound on the nonlinearity of any function from the two constructions. Then we give a lower bound on the weightwise nonlinearity of the WPB constructions in terms of Krawtchouk polynomials. 
Finally we address the algebraic immunity of the first construction in Section~\ref{sec:concrete}, exhibiting WPB functions with minimal and maximal AI.

\subsection{A nonlinearity lower bound}



\begin{theorem}\label{th:NLbound}
Let $m\in \N^*$, $n=2^m$ and $f$ be a function from the constructions of Definition~\ref{def:orderWPB} or Definition~\ref{def:orderWPB2}, then:
%\[\NL(f)\ge 2^{n-2}+2^{n-3}-2^{n/2-1}.\]
\[\NL(f)\ge 2^{n-2}.\]
\end{theorem}

\begin{proof}
We compute the Walsh transform of $f$. For all $c\in \F_2^n$:
\begin{align*}
\wt{f}(c)&=\sum_{z\in \F_2^n} (-1)^{f(z)+c z}\\
&=\sum_{x \in \F_2^{n/2}} (-1)^{f(x,x)+a x} + \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} (-1)^{f(x,y)+a x+ by},
\end{align*}
where $(a,b)=c$, that is $a$ denotes the first $n/2$ bits of $c$ and $b$ denotes the second half.

First, we can bound the absolute value of the first term: $|\sum_{x \in \F_2^{n/2}} (-1)^{f(x,x)+a x}|\le 2^{n/2}$. 
Then, we rewrite the second term:
\begin{align*}
A=\sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} (-1)^{f(x,y)+a x+ by}&=   \frac{1}{2} \left( \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} (-1)^{f(x,y)+a x+ by}+ \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} (-1)^{f(x,y)+a x+ by}\right)\\
&= \frac{1}{2} \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} \left((-1)^{f(x,y)+a x+ by} + (-1)^{f(y,x)+a y+ bx} \right)\\
&= \frac{1}{2} \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx} \right).
\end{align*}

Then, to bound $|A|$, we determine the cardinal of the set $S=\{x,y\in \F_2^{n/2} \times \F_2^{n/2}, \, x \ne y, \, | \, (-1)^{ax+by}- (-1)^{ay+bx}=0\}$. The condition $(-1)^{ax+by}- (-1)^{ay+bx}=0$ is equivalent to $ax+by=ay+bx \mod 2$, that is $(a+b)(x+y)=0 \mod 2$. 
First, note that if $a=b$ then $|S|=|\{x,y\in \F_2^{n/2} \times \F_2^{n/2}, \, x \ne y\}|=
%\binom{2^{n/2}}{2}=2^{n/2-1} (2^{n/2}-1)$. Hence we focus on the case $d=a+b\ne 0_{n/2}$. 
2^{n/2} \cdot (2^{n/2}-1)$. Hence we focus on the case $d=a+b\ne 0_{n/2}$. 

The addition by a constant $y\in \F_2^{\ell}$, $\psi_y$, defined by $\psi_y(x)=x + y$ (for $x\in \F_2^{\ell})$ is a bijection over $ \F_2^{\ell}$. Then, the image of $\psi_y(x)$ for $x\in \F_2^{\ell}\setminus \{y\}$ is $\F_2^{\ell}\setminus \{0_\ell\}$. 
Accordingly, the sum  $(x+y)$ such that $x\in \F_2^\ell, y \in \F_2^\ell\setminus \{x\} $ takes each element of $\F_2^\ell \setminus \{0_\ell\}$ exactly $2^\ell$ times. 
%Taking $x\in \F_2^\ell$ and then $y\in \F_2^\ell \setminus \{x\}$ corresponds to take exactly twice each pair $(x,y)$ such that $x\ne y$ (more precisely, the each pair is obtained as $(x,y)$ and $(y,x)$).
%\pmnote{Verify here why we need count only half the elements}
Since for $d\ne 0_\ell$ we have $|\{x \in \F_2^\ell \, | \, d \cdot x=0\}|=2^{\ell-1}$ and $d \cdot 0_\ell =0$ we obtain 
$|S|= 2^{n/2} (2^{n/2-1}-1)=2^{n-1}-2^{n/2}$. 
It allows to bound $|A|$:
\begin{align*}
|A|&=|\frac{1}{2} \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y}} (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx} \right)|\\
&=\frac{1}{2}| \sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y \text{ and } (x,y)\not \in S}} 2(-1)^{f(x,y)+a x+ by} + 
\sum_{x,y \in \F_2^{n/2} \times \F_2^{n/2} \atop {x \ne y \text{ and } (x,y) \in S}} 0|\\
%&\le \frac{1}{2}| 2 \left(\binom{2^{n/2}}{2} - %2^{n-2}+2^{n/2-1}\right) |
%= 2^{n/2-1} (2^{n/2}-1) -2^{n-2} + 2^{n/2-1}
%=2^{n-2}
&\le \frac{1}{2}| 2 \left(2^{n/2}(2^{n/2}-1) - 2^{n-1}+2^{n/2}\right) |
= |2^{n} - 2^{n/2}-2^{n-1} + 2^{n/2}|
=2^{n-1}
\end{align*}

Finally, using the relation between nonlinearity and Walsh transform we obtain:
%\[\NL(f)= 2^{n-1}-\frac{1}{2} \max_{c \in \F_2^n}|\wt{f}(c)|\ge 2^{n-1}-\frac{1}{2} \left(2^{n/2}+ 2^{n-2}\right)=2^{n-2}+2^{n-3}-2^{n/2-1}.\]
\[\NL(f)= 2^{n-1}-\frac{1}{2} \max_{c \in \F_2^n}|\wt{f}(c)|\ge 2^{n-1}-\frac{1}{2} \left(2^{n-1}\right)=2^{n-2}.\]



\end{proof}



\begin{theorem}\label{th:NLkbound}
	Let $m\in \N^*$, $n=2^m$ and $f$ be a function from the constructions of Definition~\ref{def:orderWPB} or Definition~\ref{def:orderWPB2}, then, for all $k\in [0,n]$:
	\[\NLk{k}(f) \ge \frac{1}{4} \binom{n}{k} - \binom{\frac{n}{2}}{\frac{k}{2}} - \frac{1}{2}   \max_{\ell \in [1,n]} |\sum_{t=0}^{k} \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}} |.\]
\end{theorem}

\begin{proof}
	
We compute the restricted Walsh transform of $f$ on $\Ekn{k}{n}$. For all $c\in \F_2^n$:
\begin{align*}
\wtk{f}{k}(c)&=\sum_{z\in \Ekn{k}{n}} (-1)^{f(z)+c z}\\
&=\sum_{x\in \Ekn{k/2}{n/2}} (-1)^{f(x,x)+(a+b)x} + \sum_{(x,y)\in \Ekn{k}{n},\, x \ne y} (-1)^{f(x,y)+ax+by}\\
&=\sum_{x\in \Ekn{k/2}{n/2}} (-1)^{f(x,x)+(a+b)x} + 
\sum_{t=0}^{k} \sum_{x\in \Ekn{t}{n/2}, \,y\in \Ekn{k-t}{n/2}\atop {x \ne y} } (-1)^{f(x,y)+ax+by}\\
&=\sum_{x\in \Ekn{k/2}{n/2}} (-1)^{f(x,x)+(a+b)x} + \frac{1}{2}
\sum_{t=0}^{k} \sum_{x\in \Ekn{t}{n/2}, \,y\in \Ekn{k-t}{n/2}\atop {x \ne y} }  (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx} \right)
\end{align*}
where $(a,b)=c$, that is $a$ denotes the first $n/2$ bits of $c$ and $b$ denotes the second half.

Similarly to the proof of Theorem~\ref{th:NLbound}, we are looking for the number of elements $(x,y)$ such that $(-1)^{a x+ by} - (-1)^{a y+ bx} =0$. This is equivalent to the number of elements $(x,y)$ such that $(a+b)(x+y)=0 \mod 2$ where this time $x \in \Ekn{t}{n/2}$ and $y\in \Ekn{k-t}{n/2}$. 
Denoting $a+b$ as $d$ we have that all elements lead to $0$ if $d=0_{n/2}$, for the other values of $d$ we determine it in function of $\ell=\w(d)$:
%\begin{align*}
%|S_d|&=|\{x\in \Ekn{t}{n/2}, y \in \Ekn{k-t}{n/2}\, | \, (x+y)d=0\}|\\
%&=|\{x\in \Ekn{t}{n/2}, y \in \Ekn{k-t}{n/2}\, | \, xd=yd=0\}| +|\{x\in \Ekn{t}{n/2}, y \in \Ekn{k-t}{n/2}\, | \, xd=yd=1\}|
%\\
%&=|\{x\in \Ekn{t}{n/2}\, | \, xd=0\}| \cdot  |\{y\in \Ekn{k-t}{n/2}\, | \, yd=0\}| +|\{x\in \Ekn{t}{n/2}\, | \, xd=1\}|  \cdot |\{y\in \Ekn{k-t}{n/2}\, | \, yd=1\}|
%\\
%&=\frac{1}{2}\left( \binom{n/2}{t} - \kraw{t}{\ell}{\frac{n}{2}} \right)\frac{1}{2}\left( \binom{n/2}{k-t} - \kraw{k-t}{\ell}{\frac{n}{2}} \right)
%+ \frac{1}{2}\left( \binom{n/2}{t} + \kraw{t}{\ell}{\frac{n}{2}} \right)\frac{1}{2}\left( \binom{n/2}{k-t} + \kraw{k-t}{\ell}{\frac{n}{2}} \right)\\
%&=\frac{1}{4} \left(2 \binom{n/2}{t} \binom{n/2}{k-t} + 2 \kraw{t}{\ell}{n/2} \kraw{k-t}{\ell}{n/2}\right)
%\end{align*}
\begin{align*}
|S_d|&=|\{x\in \Ekn{t}{n/2}, y \in \Ekn{k-t}{n/2}\, | \, (x+y)d=0\}|\\
&=|\{x\in \Ekn{t}{n/2}, y \in \Ekn{k-t}{n/2}\, | \, xd=yd=0\}| +|\{x\in \Ekn{t}{n/2}, y \in \Ekn{k-t}{n/2}\, | \, xd=yd=1\}|
\\
&=|\{x\in \Ekn{t}{n/2}\, | \, xd=0\}|   |\{y\in \Ekn{k-t}{n/2}\, | \, yd=0\}| +|\{x\in \Ekn{t}{n/2}\, | \, xd=1\}|   |\{y\in \Ekn{k-t}{n/2}\, | \, yd=1\}|
\end{align*}
Then, we determine $|\{x\in \Ekn{t}{n/2}\, | \, xd=0\}|$ using the definition of Krawtchouk polynomials (Definition~\ref{def:Kraw}): %and Property~\ref{prop:Kr} we have:
\begin{align*}
|\{x\in \Ekn{t}{n/2}\, | \, xd=0\}|&= \sum_{j=0 \atop j \text{ even }}^{t} \binom{\ell}{j} \binom{n/2-\ell}{t-j}\\
&= \frac{1}{2}\left( \sum_{j=0 \atop j \text{ even }}^{t} \binom{\ell}{j} \binom{n/2-\ell}{t-j} + \sum_{j=0}^{t} \binom{\ell}{j} \binom{n/2-\ell}{t-j} - \sum_{j=0 \atop j \text{ odd }}^{t} \binom{\ell}{j} \binom{n/2-\ell}{t-j} \right)\\
&=\frac{1}{2}\left( \kraw{t}{\ell}{n/2} + \sum_{j=0}^{t} \binom{\ell}{j} \binom{n/2-\ell}{t-j} \right)\\
&=\frac{1}{2}\left( \kraw{t}{\ell}{n/2} + \binom{n/2}{t} \right),
\end{align*}
where the last equation comes from the Vandermonde convolution (Property~\ref{prop:Vandermonde}). Using similar formulas for the other sets we obtain:
\begin{align*}
|S_d|&=\frac{1}{4}\left( \binom{\frac{n}{2}}{t} + \kraw{t}{\ell}{\frac{n}{2}} \right)\left( \binom{\frac{n}{2}}{k-t} + \kraw{k-t}{\ell}{\frac{n}{2}} \right)
+ \frac{1}{4}\left( \binom{\frac{n}{2}}{t} - \kraw{t}{\ell}{\frac{n}{2}} \right)\left( \binom{\frac{n}{2}}{k-t} - \kraw{k-t}{\ell}{\frac{n}{2}} \right)\\
&=\frac{1}{4} \left(2 \binom{\frac{n}{2}}{t} \binom{\frac{n}{2}}{k-t} + 2 \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}}\right).
\end{align*}

Using the value of $|S_d|$ we can derive an lower bound on $|\wtk{f}{k}(c)|$:
\begin{align*}
|\wtk{f}{k}(c)|&=|\sum_{x\in \Ekn{k/2}{n/2}} (-1)^{f(x,x)+(a+b)x} + \frac{1}{2}
\sum_{t=0}^{k} \sum_{x\in \Ekn{t}{n/2}, \,y\in \Ekn{k-t}{n/2}\atop {x \ne y} }  (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx} \right)|\\
&\le \binom{n/2}{k/2} + |\frac{1}{2} 
\sum_{t=0}^{k} \sum_{x\in \Ekn{t}{n/2}, \,y\in \Ekn{k-t}{n/2}\atop {x \ne y} }  (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx} \right)|\\
%&\ge \binom{n/2}{k/2} + |\frac{1}{2}
%\sum_{t=0}^{k} \left(\sum_{x\in \Ekn{t}{\frac{n}{2}}, \,y\in \Ekn{k-t}{\frac{n}{2}}\atop {x \ne y, \, (x,y) \in S_d}  }  (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx}\right) 
%+  \sum_{x\in \Ekn{t}{\frac{n}{2}}, \,y\in \Ekn{k-t}{\frac{n}{2}}\atop {x \ne y, \, (x,y) \not \in S_d} }  (-1)^{f(x,y)} \left( (-1)^{a x+ by} - (-1)^{a y+ bx} \right) \right)|
&\le \binom{n/2}{k/2} + |\frac{1}{2}
\sum_{t=0}^{k} \left(\sum_{x\in \Ekn{t}{\frac{n}{2}}, \,y\in \Ekn{k-t}{\frac{n}{2}}\atop {x \ne y, \, (x,y) \in S_d}  }  (-1)^{f(x,y)} (0) 
+  \sum_{x\in \Ekn{t}{\frac{n}{2}}, \,y\in \Ekn{k-t}{\frac{n}{2}}\atop {x \ne y, \, (x,y) \not \in S_d} }  2(-1)^{f(x,y)+a x+ by}   \right)|\\
%&\le \binom{\frac{n}{2}}{\frac{k}{2}}+ |\frac{1}{2}\left(
%\sum_{t\in [0,k] \setminus \{k/2\}} 2 \left( \binom{\frac{n}{2}}{t} \binom{\frac{n}{2}}{k-t}  - \frac{1}{2} \binom{\frac{n}{2}}{t} \binom{\frac{n}{2}}{k-t}    -   \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}}\right) \right) |
&\le \binom{\frac{n}{2}}{\frac{k}{2}}+ |\frac{1}{2}\left(
\left(\sum_{t=0}^{k} 2 \left( \binom{\frac{n}{2}}{t} \binom{\frac{n}{2}}{k-t}  - \frac{1}{2} \binom{\frac{n}{2}}{t} \binom{\frac{n}{2}}{k-t}    -   \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}}\right)  \right) - 2\binom{\frac{n}{2}}{\frac{k}{2}} \right) |\\
& \le 2\binom{\frac{n}{2}}{\frac{k}{2}}+ 
|\sum_{t=0}^{k} \left( \frac{1}{2} \binom{\frac{n}{2}}{t} \binom{\frac{n}{2}}{k-t}    -   \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}}\right)|\\
& \le 2\binom{\frac{n}{2}}{\frac{k}{2}}+ \frac{1}{2} \binom{n}{k}+ |\sum_{t=0}^{k} \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}}|,
\end{align*}
where the last equation comes from the Vandermonde convolution (Property~\ref{prop:Vandermonde}).

Finally, we can give the bound on the $\NLk{k}$ using the relation with the restricted Walsh transform:
\begin{align*}
\NLk{k}(f)&= \frac{1}{2} \binom{n}{k} - \frac{1}{2}\max_{c \in \F_2^n} |\wtk{f}{k}|\\
&\ge \frac{1}{2} \binom{n}{k} - \frac{1}{2}\max_{\ell \in [1,n]} \left( 2\binom{\frac{n}{2}}{\frac{k}{2}}+ \frac{1}{2} \binom{n}{k}+ |\sum_{t=0}^{k} \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}}| \right)\\
&\ge \frac{1}{4} \binom{n}{k} - \binom{\frac{n}{2}}{\frac{k}{2}} - \frac{1}{2}   \max_{\ell \in [1,n]} |\sum_{t=0}^{k} \kraw{t}{\ell}{\frac{n}{2}} \kraw{k-t}{\ell}{\frac{n}{2}} |.
\end{align*}
	
	
\end{proof}
\pmnote{re-read the proof}



\pmnote{Verify consistency with Property~\ref{prop:Kr}}

\section{Concrete constructions and parameters}\label{sec:concrete}

\subsection{WPB from popular orders}



We can take different orders to compare the properties reached in practice by the construction of Definition~\ref{def:orderWPB}. For example we will consider the orders lexicographic and cool~\cite{FUN:SteWil12}. 
For these two cases we use the lexicographic order (respectively cool order) to define the orders on the $2^i$-length binary strings for $i\in [1,m]$. We give the properties of the produced WPB functions in $8$ and $16$ variables in Table~\ref{tab:lexcool8} and Table~\ref{tab:lexcool16}. 


\pmnote{we observe that...}

The algebraic immunity of the construction from the lexicographic order is the minimal possible for a WPB function in more than $2$ variables (see~\cite{Latin:GinMea23}, Theorem $1$). In the following proposition we show that any WPB function $f$ built from Definition~\ref{def:orderWPB} or Definition~\ref{def:orderWPB2} with the lexicographic order as $\prec_{m-1}$ has AI only $2$.

\begin{proposition}
	
\end{proposition}

\begin{proof}
	
\end{proof}


%\pmnote{Other construction, an order on length $2^{m-1}$ elements and a $2$-partition for all slice $\Ekn{k}{2^{m-1}}$. }

\pmnote{definitions, parameters, proofs for lexical order and AI}



\subsection{Weightwise order}

\pmnote{Verify if TL is a subcase,
	
	verify how many TL functions, compared to order function
	
	generalize which one can be of optimal AI as TL functions.
}

\pmnote{Order orbits in lexicographic order}

\pmnote{Look at "weightwise order"}


\subsection{orders from a field representation}


\pmnote{definition, then parameters}


\section{Generalizations to WAPB constructions}
\pmnote{Generalize the order idea to WAPB function in $2n$ variables.
}


\section{Conclusion}




\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\ifnum\full=0
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{splncs04}
\bibliography{add}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\else
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{alpha}
\bibliography{add}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\fi

\end{document}
